"use strict";
var loadIndex = require('../routes/loadIndex.js')

var ClientMessageQueue = class ClientMessageQueue {

    constructor(client, add_callback, fire_callback) {
      this.messages = [];
      this.client = client;
      this.add_callback = add_callback;
      this.capacity = 0;

      console.log(this.add_callback);
    }

    setCapacity(capacity){
      this.capacity = capacity;
    }

    addMessage(fix_obj, message) {
      this.messages.push(message);
      this.add_callback(fix_obj);
      console.log(this.fire_callback);
      if(this.messages.length == this.capacity){
        loadIndex.loadIndexWithMessage(this.client, 'Trades captured!', this.messages);
      }
    }
};

module.exports = {
  getClientMQ : function(client, fire_callback){
    return new ClientMessageQueue(client, fire_callback);
  }
}